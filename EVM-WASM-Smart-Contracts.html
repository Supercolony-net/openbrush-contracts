<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>EVM &amp; WASM Smart Contracts - OpenBrush</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Openbrush</a></li><li class="chapter-item expanded "><a href="examples/index.html"><strong aria-hidden="true">1.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/psp22.html"><strong aria-hidden="true">1.1.</strong> PSP22</a></li><li class="chapter-item expanded "><a href="examples/access-control.html"><strong aria-hidden="true">1.2.</strong> Access Control &amp; PSP721</a></li><li class="chapter-item expanded "><a href="examples/ownable.html"><strong aria-hidden="true">1.3.</strong> Ownable &amp; PSP1155</a></li><li class="chapter-item expanded "><a href="examples/reentrancy-guard.html"><strong aria-hidden="true">1.4.</strong> Reentrancy Guard</a></li><li class="chapter-item expanded "><a href="examples/pausable.html"><strong aria-hidden="true">1.5.</strong> Pausable</a></li><li class="chapter-item expanded "><a href="examples/timelock-controller.html"><strong aria-hidden="true">1.6.</strong> Timelock Controller</a></li><li class="chapter-item expanded "><a href="examples/payment-splitter.html"><strong aria-hidden="true">1.7.</strong> Payment Splitter</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="links.html">Useful links</a></li><li class="chapter-item expanded affix "><a href="EVM-WASM-Smart-Contracts.html" class="active">EVM &amp; WASM Smart Contracts</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">OpenBrush</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="comparison-of-evm-smart-contracts--substrate-wasm-smart-contracts"><a class="header" href="#comparison-of-evm-smart-contracts--substrate-wasm-smart-contracts">Comparison of EVM Smart Contracts &amp; Substrate WASM Smart contracts</a></h2>
<h3 id="evm"><a class="header" href="#evm">EVM</a></h3>
<h5 id="background"><a class="header" href="#background">Background</a></h5>
<p>Ethereum was the first Turing complete blockchain and was mainly developed because of limitations of Bitcoin's script. In order to execute Smart Contracts a sandbox environment is needed. The sandbox environment where Smart contracts are executed in Ethereum is the  <strong>Ethereum virtual machine</strong> (<em>EVM</em>)</p>
<h5 id="bytecode"><a class="header" href="#bytecode">Bytecode</a></h5>
<p>EVM uses a stack-based bytecode language called EVM bytecode. EVM bytecode is a series of OP_CODE (instructions) that are executed by the EVM. These <code>OP_CODE</code>s offers rather limited instructions compare to a full extend language (Java, WASM, ..)</p>
<p>The primitive of bytecode is <em>256bit</em> integer which can be a big limitation as it is needed to use <em>256bit</em> integer to do calculations on even low numbers and also it will take <em>256bit</em> storage for any value stored on persistence.</p>
<p>The main OP_CODEs are <strong>SLOAD</strong> to load data, <strong>SSTORE</strong> to write a <em>256bit</em> integer to storage and <strong>CALL</strong> to call another contract <a href="https://github.com/crytic/evm-opcodes">full list of OP_CODES</a>. It's via these instructions that EVM interact with the chain.</p>
<p><img src="pictures/eth-1.png" alt="image info" /></p>
<h5 id="gas-model"><a class="header" href="#gas-model">Gas model</a></h5>
<p>The incentive model of interacting with EVM is gas. It acts like a fee that is calculated for each instruction you are executing. Every instruction has a certain pre-calculated fee amount, and your total gas is the sum of all the instruction you will execute.</p>
<p>Please check the entire table of <a href="https://blockgeeks.com/wp-content/uploads/2018/03/image2-2.png">fees</a>
A gas fee is only due when interacting with EVM. There is no charge for the space on storage you are using, and it is resulting by having a ton of deadcode (or non-used contracts) staying on ethereum chain forever.</p>
<h5 id="evm-process"><a class="header" href="#evm-process">Evm process</a></h5>
<p><img src="pictures/eth2.png" alt="image info" /></p>
<h3 id="substrate-contract-pallet"><a class="header" href="#substrate-contract-pallet">Substrate Contract-Pallet</a></h3>
<h5 id="intro"><a class="header" href="#intro">Intro</a></h5>
<p><code>pallet-contract</code> is a module in Substrate (the framework to build blockchain on <code>Polkadot</code>). Its purpose is a sandbox environment providing WASM interpreter to execute smart contracts in WASM.</p>
<p><img src="pictures/WASM1.png" alt="image info" /></p>
<h5 id="wasm-interpreter"><a class="header" href="#wasm-interpreter">WASM interpreter</a></h5>
<p>At the moment contract-pallet use <a href="https://github.com/paritytech/wasmi">wasmi</a> as interpreter. Wasmi is a pure interpreter-type WASM virtual machine as execution of smart contract needs a high degree of correctness.</p>
<h5 id="storage-rent--gas"><a class="header" href="#storage-rent--gas">Storage rent &amp; Gas</a></h5>
<p>In order to incentives the deletion of unused code on chain, pallet-contract implemented a storage-rent principle.</p>
<p>Data that persist on chain (the contract code + all of its storage) will be charged. So every smart contract will have a rent to pay (small amount at every block). When the smart contract will not have enough fund to pay the rent the smart contract will become a Tombstone (storage will be deleted).</p>
<p>The gas system of ethereum (price depending on the complexity of the computation) is still present, but it is charged after the call is executed as it is basically a fee on the time of execution (the more time it takes for the node to execute your call the more you will pay). The <code>pallet-contract</code> will define the <a href="https://substrate.dev/docs/en/knowledgebase/smart-contracts/contracts-pallet">amount of gas</a></p>
<h5 id="contract-code--instance-are-decoupled"><a class="header" href="#contract-code--instance-are-decoupled">Contract code &amp; instance are decoupled</a></h5>
<p>Even though pallet-contract use an account model for their contracts alike ethereum does as well, there is still a big difference:</p>
<p>When you deploy a WASM smart contract on chain it will only create a hash of the WASM code, that's mean this contract will not have an address, nor an associated storage (so no interaction possible). As opposed to ethereum where every contract code deployed on chain will have a unique address (instance), and an associated storage.</p>
<p>When the WASM hash is on chain you can create as mush as instance of this contract code. Each instance will have a unique address to interact with as well as its own associated storage.</p>
<p>It is practical for:</p>
<ul>
<li>Different contract instance with different <strong>constructors</strong> can be instantiated to reduce the space needed on chain to store WASM code</li>
<li>Storage and balance are decoupled from contract code logic, it can enable to <strong>patch or upgrade</strong> the underlying contract code</li>
</ul>
<h3 id="evm-vs-contract-pallet"><a class="header" href="#evm-vs-contract-pallet">EVM vs contract-pallet</a></h3>
<ul>
<li>Common point: they both are a sandbox to execute smart contracts</li>
<li>The engine to execute contract is different. In ethereum, as it was the first blockchain to implement n sandbox environment, it is rather limited and slow compare to a wasm interpreter</li>
<li>Storage-rent has been introduced in contract-pallet to incentives the deletion of unused code</li>
<li>Contract pallet integrated a <a href="https://substrate.dev/docs/en/knowledgebase/smart-contracts/contracts-pallet#two-step-deployment">two-step-deployment</a> to decouple contract code and contract instances</li>
</ul>
<h3 id="comparing-wasm-smart-contracts-to-evm-smart-contracts"><a class="header" href="#comparing-wasm-smart-contracts-to-evm-smart-contracts">Comparing WASM Smart contracts to EVM smart contracts</a></h3>
<ul>
<li>WASM is broadly adopted as EVM usage is only for EVM -&gt; There is way more tools available for WASM development</li>
<li>EVM bytecode can only be compiled from Solidity or Vyper while WASM can be compiled from a lot of Popular languages (Rust, C/C++, C#, Java, Typescript, Haxe, Kotlin and even from Solidity)</li>
<li>Excellent integration of Rust to compile in WASM</li>
<li>Lightweight: it produces lightweight binaries that can ship easily</li>
<li>performance near native code (2x faster than Javascipt)</li>
<li>Continually developed by major companies such as Google, Apple, Microsoft, Mozilla, and Facebook.</li>
</ul>
<p><a href="https://paritytech.github.io/ink-docs/why-webassembly-for-smart-contracts">more info here</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="links.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="links.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
